import rzpipe
from malduck import rc4
import sys

args = sys.argv
print(args)
if len(args) < 5:
  print('wrong')
  sys.exit()
r2 = rzpipe.open()
base = args[1]
off = args[2]
kl = args[3]
cl = args[4]

cmd = f'pxj {kl} @ {base} + {off}'
print(cmd)
key = r2.cmdj(cmd)

cmd = f'pxj {cl} @ {base} + {off} + {kl}'
print(cmd)
ct = r2.cmdj(cmd)
print(key)
print(ct)

pt = rc4(bytes(key), bytes(ct))
print(pt)
if b'\x00' in pt:
  print(pt.decode('utf-16'))
